/*! For license information please see main.4da6c4729a80361cf84b.bundle.js.LICENSE.txt */
(()=>{var e,t={220:(e,t,s)=>{"use strict";s.d(t,{bM:()=>y,ln:()=>_}),s(260);var i,n,a=s(964);class r{static setPlayerId(){const e=new URLSearchParams(window.location.search).get("name");console.log("name",e),this.playerId=e||"P-"+Math.floor(1e3*Math.random())}static getPlayerId(){return this.playerId}setTiles(e){this.tiles=e}getTileAt(e){}convertToTwoD(e){return{x:e%_,y:Math.floor(e/_)}}}class o{static init(){this.playerId=r.getPlayerId(),this.eventEmitter=new Phaser.Events.EventEmitter,this.socket=new a.Socket("wss://nightwatch.gigalixirapp.com/socket",{params:{userId:this.playerId}}),this.socket.connect()}static joinWorld(){this.worldChannel=this.socket.channel("game:nw_mmo",{userId:this.playerId}),this.worldChannel.join().receive("ok",(({messages:e})=>console.log("Joined WorldChannel Success",e))).receive("error",(({reason:e})=>console.log("failed to join WorldChannel",e))).receive("timeout",(()=>console.log("Networking issue. Timeout."))),this.registerEvents()}static sendMessage(e,t){this.worldChannel.push(e,t)}static registerEvents(){this.worldChannel.on("player_joined",this.onPlayerJoined.bind(this)),this.worldChannel.on("move",this.onMoveUpdated.bind(this)),this.worldChannel.on("player_terminated",this.onPlayerDied.bind(this)),this.worldChannel.on("player_respawned",this.onPlayerRespawn.bind(this)),this.worldChannel.on("player_left",this.onPlayerLeft.bind(this)),this.worldChannel.on("player_rejoined",this.onPlayerRejoined.bind(this)),window.addEventListener("beforeunload",this.onClientUnload.bind(this)),window.addEventListener("unload",this.onClientUnload.bind(this))}static onGameMap(e){console.log("game map",e),this.eventEmitter.emit("game_map",e)}static onPlayerJoined(e){console.log("game map",e),this.eventEmitter.emit("player_joined",e)}static onMoveUpdated(e){this.eventEmitter.emit("move",e)}static onPlayerDied(e){this.eventEmitter.emit("player_terminated",e.id)}static onPlayerRespawn(e){this.eventEmitter.emit("player_respawn",e)}static onPlayerLeft(e){this.eventEmitter.emit("player_left",e)}static onPlayerRejoined(e){this.eventEmitter.emit("player_rejoined",e)}static onClientUnload(){this.worldChannel.leave()}}o.isInputEnabled=!0;class l{constructor(e){this._initialiseVariables(e),this._addGameObject()}static getInstance(){return this.GameObjectInstance}_initialiseVariables({scene:e,x:t,y:s,texture:i,tileIndex:n,scale:a,container:r,tileType:o}){this._scene=e,this._x=t,this._y=s,this._scale=a,this._texture=i,this._tileIndex=n,this._container=r,this._tileType=o}_addGameObject(){this._gameObject=this._scene.add.sprite(this._x,this._y,this._texture).setScale(this._scale).setZ(1).setOrigin(0),this._container.add(this._gameObject)}getGameObject(){return this._gameObject}getType(){return this._tileType}}l.GameObjectInstance=null;class h{constructor(e){this._initialiseVariables(e),this._addGameObject()}static getInstance(){return this.GameObjectInstance}_initialiseVariables({scene:e,x:t,y:s,texture:i,tileIndex:n,scale:a,container:r,id:o}){this._scene=e,this._x=t,this._y=s,this._id=o,this._scale=a,this._texture=i,this._container=r}_addGameObject(){this._gameObject=this._scene.add.sprite(this._x,this._y,this._texture).setScale(this._scale).setZ(999).setOrigin(0),this._name=this._scene.add.text(this._x+y/2,this._y+y/2,this._id,{color:"black"}).setOrigin(.5),this._container.add(this._gameObject),this._container.add(this._name)}getGameObject(){return this._gameObject}move(e){"right"==e?(this._x=this._gameObject.x+80,this._gameObject.setX(this._x),this._name.setX(this._x+y/2)):"left"==e?(this._x=this._gameObject.x-80,this._gameObject.setX(this._x),this._name.setX(this._x+y/2)):"up"==e?(this._y=this._gameObject.y-80,this._gameObject.setY(this._y),this._name.setX(this._y+y/2)):"down"==e&&(this._y=this._gameObject.y+80,this._gameObject.setY(this._y),this._name.setX(this._y+y/2))}moveTo(e){this._x=y*e.x,this._y=y*e.y,this._gameObject.setPosition(this._x,this._y),this._name.setPosition(this._x+y/2,this._y+y/2)}getCoordinate(){return{x:Math.floor(this._x/y),y:Math.floor(this._y/y)}}getId(){return this._id}remove(){this._gameObject.setVisible(!1),this._name.setVisible(!1)}}h.GameObjectInstance=null,function(e){e[e.HERO=0]="HERO",e[e.ENEMY=1]="ENEMY"}(i||(i={})),function(e){e[e.WALL=0]="WALL",e[e.EMPTY=1]="EMPTY"}(n||(n={}));class c extends Phaser.Scene{constructor(){super({key:"MainScene"}),this.canPress=!0}create(){this.canPress=!0,this._xOff=0,this._yOff=0,this._cellSize=y,this._playerList=[],this._boardContainer=this.add.container(0,0).setDepth(1),this._enemyContainer=this.add.container(0,0).setDepth(2),this._playerContainer=this.add.container(0,0).setDepth(3),this.cursorKeys=this.scene.scene.input.keyboard.createCursorKeys(),o.joinWorld(),o.eventEmitter.on("player_joined",this.onPlayerJoined,this),o.eventEmitter.on("move",this.onPlayerMove,this),o.eventEmitter.on("player_terminated",this.onPlayerTerminated,this),o.eventEmitter.on("move_updated",this.onMoveUpdated,this),o.eventEmitter.on("player_died",this.onPlayerDied,this)}placePlayer(e){let t={scene:this,id:r.getPlayerId(),x:this._xOff+this._cellSize*e.x,y:this._yOff+this._cellSize*e.y,texture:"player",tileIndex:0,scale:1,container:this._playerContainer};this.player=new h(t),this._playerList.push(this.player)}placeEnemy(e,t){let s={id:t,scene:this,x:this._xOff+this._cellSize*e.x,y:this._yOff+this._cellSize*e.y,texture:"enemy",tileIndex:0,scale:1,container:this._enemyContainer},i=new h(s);this._playerList.push(i)}onPlayerJoined(e){console.log(e),this.drawGrid(e.map),e.id===r.getPlayerId()?this.placePlayer(e.pos):this.placeEnemy(e.pos,e.id);let t=Object.keys(e.players);for(let s=0;s<t.length;s++){let i=t[s],n=e.players[i];this.placeEnemy(n,i)}}onPlayerMove(e){console.log("id",e.id),console.log("gid",r.getPlayerId()),e.id===r.getPlayerId()&&(console.log(" player move",e),this.player.moveTo(e.position));for(let t=0;t<this._playerList.length;t++)e.id==this._playerList[t].getId()&&this._playerList[t].moveTo(e.position);console.log(e)}onPlayerTerminated(e){console.log("pleyer left",e);for(let t=0;t<this._playerList.length;t++)e==this._playerList[t].getId()&&this._playerList[t].remove()}onMoveUpdated(e){console.log(e)}onPlayerDied(e){console.log(e)}drawGrid(e){let t=0;for(let s=0;s<_;s++)for(let i=0;i<_;i++){let a={scene:this,x:this._xOff+this._cellSize*s,y:this._yOff+this._cellSize*i,texture:0==e[i][s]?"wall":"empty",tileType:0==e[i][s]?n.WALL:n.EMPTY,tileIndex:t,scale:1,container:this._boardContainer};new l(a),t++}}update(){let e=this.cursorKeys.up.isDown,t=this.cursorKeys.down.isDown,s=this.cursorKeys.left.isDown,i=this.cursorKeys.right.isDown,n=this.cursorKeys.space.isDown;e&&this.canPress?(console.log("up"),this.canPress=!1,this.sendPlayerMove({x:0,y:-1})):t&&this.canPress?(console.log("down"),this.canPress=!1,this.sendPlayerMove({x:0,y:1})):s&&this.canPress?(console.log("left"),this.canPress=!1,this.sendPlayerMove({x:-1,y:0})):i&&this.canPress?(console.log("right"),this.canPress=!1,this.sendPlayerMove({x:1,y:0})):n&&this.canPress&&(console.log("space"),this.canPress=!1,this.sendHit(this.player.getCoordinate())),t||s||e||i||n||(this.canPress=!0)}sendPlayerMove(e){o.sendMessage("move",{id:r.getPlayerId(),dir:e})}sendHit(e){o.sendMessage("hit",{id:r.getPlayerId(),pos:e})}}class d extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}preload(){this.load.image("player","assets/img/player.png"),this.load.image("enemy","assets/img/enemy.png"),this.load.image("wall","assets/img/wall.png"),this.load.image("empty","assets/img/empty.png")}create(){r.setPlayerId(),o.init(),this.scene.start("MainScene")}}const y=80,_=10,p={type:Phaser.AUTO,backgroundColor:"#ffffff",scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:800,height:1280},scene:[d,c],physics:{default:"arcade",arcade:{debug:!1,gravity:{y:400}}}};window.addEventListener("load",(()=>{new Phaser.Game(p)}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function i(e){var n=s[e];if(void 0!==n)return n.exports;var a=s[e]={exports:{}};return t[e].call(a.exports,a,a.exports,i),a.exports}i.m=t,e=[],i.O=(t,s,n,a)=>{if(!s){var r=1/0;for(c=0;c<e.length;c++){for(var[s,n,a]=e[c],o=!0,l=0;l<s.length;l++)(!1&a||r>=a)&&Object.keys(i.O).every((e=>i.O[e](s[l])))?s.splice(l--,1):(o=!1,a<r&&(r=a));if(o){e.splice(c--,1);var h=n();void 0!==h&&(t=h)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[s,n,a]},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var n,a,[r,o,l]=s,h=0;for(n in o)i.o(o,n)&&(i.m[n]=o[n]);if(l)var c=l(i);for(t&&t(s);h<r.length;h++)a=r[h],i.o(e,a)&&e[a]&&e[a][0](),e[r[h]]=0;return i.O(c)},s=self.webpackChunknw_mmp=self.webpackChunknw_mmp||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.O(void 0,[216],(()=>i(220)));var n=i.O(void 0,[216],(()=>i(204)));n=i.O(n)})();